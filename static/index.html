<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Project 4869 Dashboard</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #121212; color: #e0e0e0; margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 320px; background: #1e1e1e; padding: 25px; border-right: 1px solid #333; box-sizing: border-box; }
        .content { flex: 1; padding: 25px; display: flex; flex-direction: column; }
        h2 { color: #ce1212; margin-top: 0; }
        .form-group { margin-bottom: 20px; }
        label { display: block; font-size: 12px; color: #888; margin-bottom: 5px; text-transform: uppercase; }
        input { width: 100%; padding: 10px; background: #2a2a2a; border: 1px solid #444; color: #fff; border-radius: 4px; box-sizing: border-box; }
        button { width: 100%; padding: 12px; background: #ce1212; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin-bottom: 10px; }
        button:hover { background: #ff1e1e; }
        .log-box { flex: 1; background: #000; color: #00ff00; padding: 15px; font-family: 'Consolas', monospace; overflow-y: auto; border-radius: 6px; border: 1px solid #333; line-height: 1.5; }
    </style>
</head>
<body>
    <div class="sidebar">
        <h2>ğŸ•µï¸ è®¾ç½®ä¸­å¿ƒ</h2>
        <div class="form-group">
            <label>CloudDrive2 Token</label>
            <input type="password" id="cd2" placeholder="å¡«å†™ CD2 API Token">
        </div>
        <div class="form-group">
            <label>Emby Server URL</label>
            <input type="text" id="emby_url" placeholder="http://192.168.x.x:8096">
        </div>
        <button onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
        <hr style="border: 0; border-top: 1px solid #333; margin: 25px 0;">
        <button style="background: #0062cc;" onclick="runTask()">ğŸš€ ç«‹å³æŠ“å–ä¸€æ¬¡</button>
    </div>
    <div class="content">
        <h2>å®æ—¶æŠ“å–æ—¥å¿—</h2>
        <div class="log-box" id="logBox">æ­£åœ¨è¿æ¥æ—¥å¿—æµ...<br></div>
    </div>

    <script>
        // å®æ—¶è·å– SSE æ—¥å¿—
        const logBox = document.getElementById('logBox');
        const eventSource = new EventSource('/api/logs');
        eventSource.onmessage = function(e) {
            const div = document.createElement('div');
            div.textContent = `[${new Date().toLocaleTimeString()}] ${e.data}`;
            logBox.appendChild(div);
            logBox.scrollTop = logBox.scrollHeight;
        };

        function saveConfig() {
            const data = {
                cd2_token: document.getElementById('cd2').value,
                emby_url: document.getElementById('emby_url').value
            };
            fetch('/api/config', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(data)
            }).then(() => alert("é…ç½®å·²åº”ç”¨å¹¶å­˜å…¥æ•°æ®åº“"));
        }

        function runTask() {
            fetch('/api/run', {method: 'POST'})
                .then(res => res.json())
                .then(data => console.log(data.message));
        }
    </script>
</body>
</html>